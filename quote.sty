\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{sty/quote}[Display Quote Authors]

\RequirePackage{etoolbox}   % add methods to an environment
\RequirePackage{ifthen}     % provide boolean


\makeatletter % Grant access to private commands (Name contains an @).


% Give the internal start and end commands of the quote environment aliases to be able to call them later on.
\let\@oldquote\quote        % begin{quote}
\let\@endoldquote\endquote  % end{quote}

\newboolean{hasMetaData}
\setboolean{hasMetaData}{false}

% Modify environment \begin{quote}
% - if set, display the author and page information below the quote
\renewenvironment{quote}
{
    \@oldquote % begin{quote}
}
{
    \par\nobreak\smallskip\hfill
    (
    \@ifundefined{@sourcename}{}
    {
        \@sourcename%
        \setboolean{hasMetaDahasMetaDatata}{true}%
    }
    \@ifundefined{@pagenumbers}{}
    {
        \@drawEmDash%
        Seite \@pagenumbers%
        \setboolean{hasMetaData}{true}%
    }
    \@ifundefined{@linenumbers}{}
    {
        \@drawEmDash%
        Zeile \@linenumbers%
        \setboolean{hasMetaData}{true}%
    }
    )

    \@endoldquote % end{quote}
    \addvspace{\bigskipamount}
}


\newcommand{\@drawEmDash}
{
    \ifthenelse{\boolean{}}{---}{}
}
        
        
% Declare private methods.
\newcommand{\@setsource}{}
\newcommand{\@setpages}{}
\newcommand{\@setlines}{}


% Define public methods.
\AtBeginEnvironment{quote}
{
    % Define method \source{source}
    % - display the source below the quote
    % - only accessible inside the environment (aka method)
    % @param #1 Name of the source to display
    \renewcommand{\@setsource}[1]
    {
        \newcommand\@sourcename{#1} % save name of the source
    }
    \global\let\source\@setsource % Make the method public inside the environment.


    % Define \page{page}
    % - display the page number below the quote
    % - only accessible inside the environment (aka method)
    % @param #1 Page number(s) to display, e.g. 12 or 3--6
    \renewcommand{\@setpages}[1]
    {
        \newcommand\@pagenumbers{#1} % save page number(s)
    }
    \global\let\pages\@setpages % Make the method public inside the environment.


    % Define \line{line}
    % - display the line number below the quote
    % - only accessible inside the environment (aka method)
    % @param #1 Line number(s) to display, e.g. 12 or 3--6
    \renewcommand{\@setlines}[1]
    {
        \newcommand\@linenumbers{#1} % save line number(s)
    }
    \global\let\lines\@setlines % Make the method public inside the environment.
}


\makeatother % Revoke access to private commands (Name contains an @).